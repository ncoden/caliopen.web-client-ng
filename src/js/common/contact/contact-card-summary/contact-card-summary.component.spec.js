import contactModule from '../index.js';

describe('component contact-card-summary', () => {
  let $componentController;

  beforeEach(() => {
    angular.mock.module(contactModule);
  });

  beforeEach(angular.mock.inject((_$componentController_) => {
    $componentController = _$componentController_;
  }));


  it('handle changes & validate form', () => {
    const contact = {
      title: '',
      given_name: 'J.',
      family_name: 'Doe',
    };
    const updatedContact = { ...contact, given_name: 'John' };

    const onChange = jasmine.createSpy('onChange');
    const ctrl = $componentController('contactCardSummary', null, { contact, onChange });

    ctrl.handleChanges('given_name', { model: updatedContact.given_name });
    ctrl.validate();

    expect(ctrl.contact).not.toEqual(contact);
    expect(JSON.stringify(ctrl.contact)).toEqual(JSON.stringify(updatedContact));
    expect(onChange).toHaveBeenCalledWith({ $event: { contact: ctrl.contact } });
  });
});
