const moduleName = 'caliopenApp';

describe('component Account', () => {
  let $componentController;
  const me = {
    user_id: '344489c3-fc63-4e41-b490-5f4dd317aa50',
    given_name: 'foo',
    family_name: 'bar',
    contact: {},
  };

  beforeEach(() => {
    // TODO: dependency on root app component to remove
    angular.mock.module(moduleName, ($provide, $translateProvider) => {
      $translateProvider.translations('en', {});
      $translateProvider.preferredLanguage('en');
      $provide.decorator('$httpBackend', ($delegate, ApiUrl) => {
        $delegate.whenRoute('GET', `${ApiUrl}/me`).respond(200, me);

        return $delegate;
      });
    });
  });

  beforeEach(angular.mock.inject((_$componentController_) => {
    $componentController = _$componentController_;
  }));

  it('init', inject(($httpBackend) => {
    const ctrl = $componentController('account', null, { });

    expect(ctrl).toBeDefined();

    ctrl.$onInit();
    $httpBackend.flush();
    expect(ctrl.user).toEqual(me);
    expect(ctrl.remoteIdentities.length).toEqual(0);
  }));
});
